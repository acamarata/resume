import { BlogLayout } from '@/components/BlogLayout'

export const article = {
  author: 'Aric Camarata',
  date: '2023-11-14',
  title: 'Moon Cycle: Bringing NASA\'s Lunar Imagery to JavaScript Developers',
  description:
    'Building a JavaScript library that maps dates to precise lunar phases using NASA\'s high-resolution moon imagery for photographers, astronomers, and developers.',
}

export const metadata = {
  title: article.title,
  description: article.description,
}

export default (props) => <BlogLayout article={article} {...props} />

As both a developer and astronomy enthusiast, I've always been fascinated by the moon's phases and their impact on everything from ocean tides to night photography. When I discovered NASA's incredible collection of hourly moon images, I saw an opportunity to create something useful for the developer community.

## The Inspiration

The project began when I was planning a nighttime photography session. I needed to know not just the moon phase, but exactly how the moon would look at a specific hour. Existing libraries could tell me "waxing gibbous," but I wanted to see the actual lunar surface with its shadows and features at that precise moment.

NASA's Scientific Visualization Studio had exactly what I needed: thousands of high-resolution images showing the moon's appearance throughout its cycle. The challenge was making this treasure trove accessible to JavaScript developers.

## Building the Moon Cycle Library

The library provides two main datasets:

- **Yearly collection**: 8,760 images (one for each hour of the year)
- **Monthly collection**: 708 images for typical phase cycles

Each image is available in multiple resolutions (256px and 512px) and quality levels (75% and 85% JPEG).

### Core Functionality

The API is intentionally simple:

```javascript
const { cycleMonth, cycleYear } = require('moon-cycle');

// Get moon phase for current moment
const date = new Date();
const monthlyPhase = cycleMonth(date);
const yearlyPhase = cycleYear(date);

// Use in your application
const moonImage = `/images/moon/month/512/85/${monthlyPhase}.jpg`;
```

## Technical Challenges

### 1. Accurate Phase Calculation

Lunar phase calculation involves complex astronomy. The moon's orbit is elliptical, and its speed varies. I implemented algorithms that account for:

- The moon's orbital eccentricity
- Perturbations from the sun's gravity
- The slight wobble (libration) that lets us see 59% of the moon's surface

### 2. Image Organization

With nearly 9,000 images, organization was crucial. I structured them hierarchically:

```
images/
├── year/
│   ├── 256/
│   │   ├── 75/
│   │   └── 85/
│   └── 512/
│       ├── 75/
│       └── 85/
└── month/
    └── ... (similar structure)
```

### 3. Performance Optimization

Loading thousands of images efficiently required careful consideration:

```javascript
// Lazy loading approach
function loadMoonImage(phase, resolution = 512, quality = 85) {
  const img = new Image();
  img.loading = 'lazy';
  img.src = `/images/moon/month/${resolution}/${quality}/${phase}.jpg`;
  return img;
}

// Preload adjacent phases for smooth transitions
function preloadAdjacentPhases(currentPhase) {
  const phases = [currentPhase - 1, currentPhase + 1];
  phases.forEach(phase => {
    if (phase >= 0 && phase <= 29) {
      loadMoonImage(phase);
    }
  });
}
```

## Real-World Applications

The library has found use in diverse applications:

### Photography Planning

Photographers use it to visualize exact lighting conditions:

```javascript
function getMoonIllumination(date) {
  const phase = cycleMonth(date);
  const illumination = (phase / 29.53) * 100;
  
  return {
    phase,
    illumination,
    image: `/images/moon/month/512/85/${phase}.jpg`,
    optimal_landscape: illumination > 30 && illumination < 70
  };
}
```

### Educational Tools

Science educators create interactive moon phase demonstrations:

```javascript
// Moon phase animation
let currentPhase = 0;
const animate = setInterval(() => {
  displayMoonImage(currentPhase);
  currentPhase = (currentPhase + 1) % 30;
}, 100);
```

### Agricultural Applications

Farmers practicing biodynamic agriculture track planting cycles:

```javascript
function getPlantingPhase(date) {
  const phase = cycleMonth(date);
  const isWaxing = phase < 15;
  
  return {
    phase,
    isWaxing,
    leafDays: isWaxing && phase < 7,
    fruitDays: phase >= 7 && phase < 14,
    rootDays: phase >= 14 && phase < 21,
    restDays: phase >= 21
  };
}
```

## Integration Examples

### React Component

```jsx
function MoonPhaseDisplay({ date }) {
  const [moonImage, setMoonImage] = useState('');
  
  useEffect(() => {
    const phase = cycleMonth(date);
    setMoonImage(`/images/moon/month/512/85/${phase}.jpg`);
  }, [date]);
  
  return (
    <div className="moon-container">
      <img src={moonImage} alt="Current moon phase" />
      <p>Phase: {getMoonPhaseName(date)}</p>
    </div>
  );
}
```

### Vue.js Integration

```javascript
<template>
  <div class="moon-phase">
    <img :src="moonImageUrl" :alt="phaseName" />
    <p>{{ phaseName }}</p>
  </div>
</template>

<script>
import { cycleMonth } from 'moon-cycle';

export default {
  computed: {
    moonImageUrl() {
      const phase = cycleMonth(this.date);
      return `/images/moon/month/512/85/${phase}.jpg`;
    },
    phaseName() {
      return this.calculatePhaseName(this.date);
    }
  }
}
</script>
```

## Performance Metrics

The library is lightweight and fast:

- Core library size: 12KB minified
- Phase calculation: Less than 0.1ms
- Image loading: Depends on resolution (average 50-200KB per image)
- Memory efficient: No data persistence required

## Handling Edge Cases

### Timezone Considerations

Since the moon appears the same globally (just at different times), I handled timezone conversions:

```javascript
function getMoonPhaseUTC(localDate) {
  // Convert to UTC for consistent calculations
  const utcDate = new Date(
    localDate.getTime() + localDate.getTimezoneOffset() * 60000
  );
  return cycleMonth(utcDate);
}
```

### Leap Years and Calendar Variations

The library accounts for calendar irregularities:

```javascript
function adjustForLeapYear(date) {
  const year = date.getFullYear();
  const isLeap = (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
  
  // Adjust calculations for leap years
  return isLeap ? cycleYear(date) : cycleYear(date) - 24;
}
```

## Future Enhancements

I'm planning several exciting features:

1. **3D Moon Visualization**: Using WebGL for interactive lunar models
2. **Libration Visualization**: Showing the moon's wobble over time
3. **Eclipse Prediction**: Integrating solar and lunar eclipse calculations
4. **Mobile SDK**: Native modules for React Native and Flutter
5. **AI Enhancement**: Using machine learning to interpolate between images for smoother animations

## Community Impact

The response from the developer community has been heartwarming:

- Astronomy apps use it for accurate moon displays
- Weather applications show moon phases alongside forecasts
- Gaming developers create realistic night scenes
- Artists use it for reference in digital paintings

## Conclusion

Moon Cycle demonstrates how wrapping complex astronomical data in a simple API can enable creative applications. By making NASA's lunar imagery easily accessible to JavaScript developers, we've opened new possibilities for education, art, and science.

The project reminds me why I love open source: taking something complex and making it simple enough that others can build amazing things with it. Whether you're planning the perfect moonlit photograph or teaching students about lunar phases, accurate moon visualization is now just an npm install away.

[Explore Moon Cycle on GitHub](https://github.com/acamarata/moon-cycle)